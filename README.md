# Counter

![Counter Logo](logo/logo.png)

### Описание
Библиотека Starter предоставляет удобный интерфейс для управления systemd-юнитами через D-Bus. Она позволяет запускать, останавливать и отслеживать состояние служб systemd, обеспечивая надежный и простой способ взаимодействия с системным менеджером служб Linux.

### Возможности
- Запуск systemd-юнитов через D-Bus интерфейс
- Остановка systemd-юнитов
- Ожидание завершения операций с юнитами
- Обработка сигналов D-Bus
- Отслеживание состояния systemd-юнитов в реальном времени
- Поддержка как синхронного, так и асинхронного взаимодействия

### Зависимости
- C++20-
- sdbus-c++ (библиотека для работы с D-Bus)
- systemd с поддержкой D-Bus

### Опции сборки

Проект предоставляет следующие опции сборки через CMake:

- **BUILD_SHARED_LIBS** - выбор типа библиотеки для сборки:
    - `ON` (по умолчанию) — сборка динамической библиотеки (`.so`)
    - `OFF` - сборка статической библиотеки (`.a`)

- **BUILD_EXAMPLE** - включение/отключение сборки примера:
    - `ON` - собирать пример использования библиотеки
    - `OFF` (по умолчанию) — не собирать пример

### Сборка

Проект использует CMake для сборки:

````bash
mkdir build
cd build
cmake ..
make
````

#### Сборка только статической библиотеки

````bash
mkdir build
cd build
cmake -DBUILD_SHARED_LIBS=OFF ..
make
````

#### Сборка только статической библиотеки без примера

``` bash
mkdir build
cd build
cmake -DBUILD_SHARED_LIBS=OFF -DBUILD_EXAMPLE=OFF ..
make
```

#### Для создания пакета DEB:

``` bash
cd build
make package
```

### Установка

После сборки можно установить библиотеку:

``` bash
sudo make install
```

Или установить созданный DEB-пакет:

``` bash
sudo dpkg -i libstarter0*.deb
```

При сборке динамической библиотеки создаются два пакета:

- `libstarter0` - содержит саму динамическую библиотеку
- `libstarter0-dev` - содержит заголовочные файлы и символьные ссылки для разработки

При сборке статической библиотеки создается только один пакет:

- `libstarter0-dev` - содержит статическую библиотеку и заголовочные файлы

### Пример использования
``` cpp
#include <iostream>
#include <starter/starter.hpp>

int main() {
    try {
        // Создание объекта для управления службой
        auto starter = tools::dbus::IStarter::create("nginx.service");
        
        // Остановка службы
        std::cout << "Останавливаем службу nginx..." << std::endl;
        starter->stop().poll();
        std::cout << "Служба nginx остановлена" << std::endl;
        
        // Запуск службы
        std::cout << "Запускаем службу nginx..." << std::endl;
        starter->start().poll();
        std::cout << "Служба nginx запущена" << std::endl;
        
    } catch (const std::exception& e) {
        std::cerr << "Ошибка: " << e.what() << std::endl;
        return 1;
    }
    
    return 0;
}
```

### Ограничения
- Для корректной работы библиотеки требуется доступ к системной шине D-Bus
- В контейнерных средах (Docker, LXC) могут потребоваться дополнительные настройки для доступа к D-Bus
- Для управления некоторыми службами может потребоваться запуск с правами root

